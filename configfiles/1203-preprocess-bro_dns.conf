# Author: Justin Henderson
# Email: jhenderson@tekrefresh.comes
# Last Update: 5/10/2016
#
# This conf file is based on accepting logs for dns.log from Bro systems

filter {
  if [type] == "bro_dns" {
    # This is the initial parsing of the log
    csv {
      # If you use a custom delimiter, change the following value in between the quotes to your delimiter. Otherwise, insert a literal <tab> in between the two quotes on your logstash system, use a text editor like nano that doesn't convert tabs to spaces.
      separator => "	"

      columns => [ "timestamp", "uid", "source_ip", "source_port", "destination_ip", "destination_port", "aprotocol", "transaction_id", "rtt", query", "query_class", "rrclass", "query_type", "querytype", "response_code", "response_code_name", "authoritative", "truncated", "recursion_desired", "recursion_available", "z", "answer", "ttl", "rejected" ]
    }

    mutate {
      split => {
        "ttl" => ","
        "answer" => ","
      }
    }

    if [ttl] == "-" {
      mutate {
        remove_field => [ "ttl" ]
      }
    }
  }
}